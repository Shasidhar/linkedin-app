<html>
<head>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="highcharts.js"></script>
    <title>LinkedIn JavaScript API Hello World</title>

    <!-- 1. Include the LinkedIn JavaScript API and define a onLoad callback function -->
    <script type="text/javascript" src="https://platform.linkedin.com/in.js">
     api_key:75h4v3j41fph8x
     // onLoad: onLinkedInLoad
      authorize: true
     </script>

    <script type="text/javascript">
    jQuery(document).ready(function () {
        $("#loginbutton").bind('click',function(){
            IN.User.authorize();
            IN.Event.on(IN, 'auth', function(){
            onLinkedInAuth();
            });
        });
    })
        unique = function( arr ){
            return _.uniq( _.collect( arr, function( x ){
                return x;
            }));
        };
        // 2. Runs when the JavaScript framework is loaded
        function onLinkedInLoad() {
            IN.Event.on(IN, "auth", onLinkedInAuth);
        }

        // 2. Runs when the viewer has authenticated
        function onLinkedInAuth() {
            IN.API.Connections("me")
                    .fields("firstName", "lastName", "industry","positions:(company)")
                    .result(displayProfiles);
        }

        // 2. Runs when the Profile() API call returns successfully
        function displayProfiles(profiles) {
            /*member = profiles.values[0];
            document.getElementById("profiles").innerHTML =
                    "<p id=\"" + member.id + "\">Hello " +  member.firstName + " " + member.lastName + "</p>";*/
            var members = profiles.values;
            var companiesArray = new Array() ;
            var space = " ";
            var dot = "\.";
            for(i=0;i<members.length;i++){
                var member = members[i];
                if(member.positions!=undefined && member.positions.values!=undefined && member.positions.values.length>0){
                    var companyName = member.positions.values[0].company.name.toLowerCase();
                    var spaceReplaced = companyName.replace(new RegExp(space,'g'),"-");
                    var finalName = spaceReplaced.replace(".","");
                    companiesArray.push(finalName);
                }
            }
            var counts = {};
            var uniqueArray = unique(companiesArray);
            for(var i = 0; i< companiesArray.length; i++) {
                var num = companiesArray[i];
                counts[num] = counts[num] ? counts[num]+1 : 1;
            }
            var intermediateJsonArray = new Array();
            for(var j=0;j<uniqueArray.length;j++){
               intermediateJsonArray.push({"name":uniqueArray[j],"count":counts[uniqueArray[j]]})
            }
            var resultArray = intermediateJsonArray.sort(function(a,b){return b.count - a.count;})
            var chartInput = resultArray.map(function(data){return [data.name,data.count];})
            drawChart(chartInput);
        }
    </script>
</head>
<link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet">
<body>
<!--<script type="in/Login"></script>-->
<button id="loginbutton" class="btn btn-primary">Login with linkedIn</button>
<div id="profiles"></div>
<div id="container" class="container" style="min-height:80%;">
</div>
</body>
<script type="text/javascript">
function drawChart(input){
    $('#container').highcharts({
        credits:false,
        chart: {
            plotBackgroundColor: null,
            plotBorderWidth: 1,//null,
            plotShadow: false
        },
        title: {
            text: 'Distribution of your connections company wise in LinkedIn'
        },
        tooltip: {
            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
        },
        plotOptions: {
            pie: {
                allowPointSelect: true,
                cursor: 'pointer',
                dataLabels: {
                    enabled: true,
                    format: '<b>{point.name}</b>: {point.percentage:.1f} %',
                    style: {
                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                    }
                }
            }
        },
        series: [{
            type: 'pie',
            name: 'Company name',
            data: input
        }]
    });
}
</script>
</html>